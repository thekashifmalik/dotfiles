#!/bin/bash
set -eo pipefail

[[ -z $1 ]] && echo "No key provided" && exit 1
KEY=$1
[[ -z $2 ]] && echo "No file provided" && exit 1
VAULT_FILE=$2

FILE=${VAULT_FILE#vault/}
mkdir -pv `dirname $FILE`

ARCHIVE_FILE=tmp/$FILE.tar
openssl/bin/decrypt-file $KEY $VAULT_FILE > $ARCHIVE_FILE
echo "decrypted '$VAULT_FILE' -> '$ARCHIVE_FILE'"

tar -xvf $ARCHIVE_FILE
echo extracted \'$ARCHIVE_FILE\'

rm -v $ARCHIVE_FILE
