#!/usr/bin/env bash
set -eo pipefail

TARGET=somememes
HOST=desktop-1

echo "Backing up: $TARGET @ $HOST"

echo "Dumping DB"
ssh $HOST "cd $TARGET && bin/pg_dump > db.sql"

rsync -hav --delete \
    $HOST:$TARGET/db.sql \
    $HOST:/mnt/HDD-3/$TARGET/media \
    /volume1/$TARGET

ssh $HOST "rm -v $TARGET/db.sql"
