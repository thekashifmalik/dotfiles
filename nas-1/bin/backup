#!/usr/bin/env bash
set -eo pipefail

[[ -z "$@" ]] && echo "No files provided" && exit 1
FILES="$@"


for FILE in $FILES
do
    echo "> Reading: $FILE"
    SOURCES=""
    while read SOURCE
    do
        echo "> Found: $SOURCE"
        SOURCES="$SOURCES $SOURCE"
    done < $FILE

    _TARGET=`basename $FILE`
    TARGET=${_TARGET//.//}

    DESTINATION=/volume1/$TARGET
    rsync -havs --delete $SOURCES $DESTINATION
done
